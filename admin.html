<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Finance Point - Admin Panel</title>
  <style>
    body, html {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      min-height: 100vh;
    }
    header {
      background: #ffb700;
      color: #000;
      padding: 1rem 2rem;
      font-weight: bold;
      font-size: 1.5rem;
    }
    nav {
      display: flex;
      background: #203a43;
      padding: 0.5rem 1rem;
    }
    nav button {
      background: none;
      border: none;
      color: #fff;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    nav button:hover,
    nav button.active {
      background: #ffb700;
      color: #000;
      font-weight: bold;
      border-radius: 5px;
    }
    main {
      padding: 1rem 2rem;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    label {
      display: block;
      margin: 1rem 0 0.3rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
    }
    button.submit-btn {
      margin-top: 1rem;
      background: #ffb700;
      color: #000;
      border: none;
      padding: 0.7rem 1.2rem;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s ease;
    }
    button.submit-btn:hover {
      background: #ffa500;
    }
    .logout-btn {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: #ff4d4d;
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    .logout-btn:hover {
      background: #ff0000;
    }
    .message {
      margin-top: 1rem;
      font-weight: bold;
    }
  </style>
</head>
<body>

<header>
  Finance Point Admin Panel
  <button class="logout-btn" id="logoutBtn">Logout</button>
</header>

<nav>
  <button class="tab-btn active" data-target="executives">Executives</button>
  <button class="tab-btn" data-target="announcements">Announcements</button>
  <button class="tab-btn" data-target="events">Events</button>
</nav>

<main>
  <section id="executives" class="active">
    <h2>Manage Executives</h2>
    <label for="execName">Name:</label>
    <input type="text" id="execName" placeholder="Executive Name" />
    <label for="execRole">Role:</label>
    <input type="text" id="execRole" placeholder="Role (e.g. President)" />
    <button class="submit-btn" id="addExecBtn">Add Executive</button>
    <div id="execMessage" class="message"></div>
    <ul id="execList"></ul>
  </section>

  <section id="announcements">
    <h2>Manage Announcements</h2>
    <label for="announcementText">Announcement:</label>
    <textarea id="announcementText" rows="3" placeholder="Write announcement here"></textarea>
    <button class="submit-btn" id="addAnnouncementBtn">Add Announcement</button>
    <div id="announcementMessage" class="message"></div>
    <ul id="announcementList"></ul>
  </section>

  <section id="events">
    <h2>Manage Events</h2>
    <label for="eventTitle">Title:</label>
    <input type="text" id="eventTitle" placeholder="Event Title" />
    <label for="eventDate">Date:</label>
    <input type="date" id="eventDate" />
    <button class="submit-btn" id="addEventBtn">Add Event</button>
    <div id="eventMessage" class="message"></div>
    <ul id="eventList"></ul>
  </section>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH5H1FWEcHmQiCQhoc6GE8GhizqhTZoQc",
    authDomain: "finsa-connect.firebaseapp.com",
    projectId: "finsa-connect",
    storageBucket: "finsa-connect.firebasestorage.app",
    messagingSenderId: "126845965255",
    appId: "1:126845965255:web:c82539297a8464873d7fe2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Redirect non-admin users to login
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const userDocRef = doc(db, "users", user.uid);
      const userSnap = await getDocs(collection(db, "users"));
      const userRef = userSnap.docs.find(doc => doc.id === user.uid);
      if (userRef) {
        const userData = userRef.data();
        if (!userData.admin) {
          alert("Access denied. You are not an admin.");
          await signOut(auth);
          window.location.href = "login.html";
        }
      } else {
        alert("User data not found.");
        await signOut(auth);
        window.location.href = "login.html";
      }
    } else {
      window.location.href = "login.html";
    }
  });

  // Logout button
  const logoutBtn = document.getElementById('logoutBtn');
  logoutBtn.addEventListener('click', async () => {
    await signOut(auth);
    window.location.href = "login.html";
  });

  // Tabs
  const tabButtons = document.querySelectorAll('.tab-btn');
  const sections = document.querySelectorAll('main section');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const target = btn.getAttribute('data-target');
      sections.forEach(sec => {
        sec.classList.toggle('active', sec.id === target);
      });
    });
  });

  // === Executives Management ===
  const execList = document.getElementById('execList');
  const execNameInput = document.getElementById('execName');
  const execRoleInput = document.getElementById('execRole');
  const execMessage = document.getElementById('execMessage');
  const execCollection = collection(db, "executives");

  async function loadExecutives() {
    execList.innerHTML = "";
    const querySnapshot = await getDocs(execCollection);
    querySnapshot.forEach(docSnap => {
      const exec = docSnap.data();
      const li = document.createElement('li');
      li.textContent = `${exec.name} - ${exec.role}`;
      const delBtn = document.createElement('button');
      delBtn.textContent = "Delete";
      delBtn.style.marginLeft = "10px";
      delBtn.onclick = async () => {
        await deleteDoc(doc(db, "executives", docSnap.id));
        execMessage.textContent = "Executive deleted.";
        loadExecutives();
      };
      li.appendChild(delBtn);
      execList.appendChild(li);
    });
  }

  document.getElementById('addExecBtn').addEventListener('click', async () => {
    const name = execNameInput.value.trim();
    const role = execRoleInput.value.trim();
    execMessage.textContent = "";
    if (!name || !role) {
      execMessage.textContent = "Please fill both fields.";
      return;
    }
    await addDoc(execCollection, { name, role });
    execMessage.textContent = "Executive added.";
    execNameInput.value = "";
    execRoleInput.value = "";
    loadExecutives();
  });

  loadExecutives();

  // === Announcements Management ===
  const announcementList = document.getElementById('announcementList');
  const announcementText = document.getElementById('announcementText');
  const announcementMessage = document.getElementById('announcementMessage');
  const announcementCollection = collection(db, "announcements");

  async function loadAnnouncements() {
    announcementList.innerHTML = "";
    const querySnapshot = await getDocs(announcementCollection);
    querySnapshot.forEach(docSnap => {
      const ann = docSnap.data();
      const li = document.createElement('li');
      li.textContent = ann.text;
      const delBtn = document.createElement('button');
      delBtn.textContent = "Delete";
      delBtn.style.marginLeft = "10px";
      delBtn.onclick = async () => {
        await deleteDoc(doc(db, "announcements", docSnap.id));
        announcementMessage.textContent = "Announcement deleted.";
        loadAnnouncements();
      };
      li.appendChild(delBtn);
      announcementList.appendChild(li);
    });
  }

  document.getElementById('addAnnouncementBtn').addEventListener('click', async () => {
    const text = announcementText.value.trim();
    announcementMessage.textContent = "";
    if (!text) {
      announcementMessage.textContent = "Please enter announcement text.";
      return;
    }
    await addDoc(announcementCollection, { text });
    announcementMessage.textContent = "Announcement added.";
    announcementText.value = "";
    loadAnnouncements();
  });

  loadAnnouncements();

  // === Events Management ===
  const eventList = document.getElementById('eventList');
  const eventTitleInput = document.getElementById('eventTitle');
  const eventDateInput = document.getElementById('eventDate');
  const eventMessage = document.getElementById('eventMessage');
  const eventsCollection = collection(db, "events");

  async function loadEvents() {
    eventList.innerHTML = "";
    const querySnapshot = await getDocs(eventsCollection);
    querySnapshot.forEach(docSnap => {
