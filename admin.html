<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel | FINSA</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom right, #f0f4f8, #dfefff);
      color: #1e293b;
    }
    header {
      background: linear-gradient(to right, #10b981, #3b82f6);
      color: white;
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logout-btn {
      background-color: #ef4444;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 1rem;
      justify-content: center;
      background: transparent;
    }
    .tabs button {
      padding: 0.7rem 1.2rem;
      background-color: #e2e8f0;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      color: #1e293b;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .tabs button.active {
      background-color: #2563eb;
      color: white;
    }
    section {
      display: none;
      margin: 1rem auto;
      padding: 1.5rem;
      width: 95%;
      max-width: 900px;
      border-radius: 12px;
      background: linear-gradient(to bottom right, #f9fafb, #e0f2fe);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    section.active {
      display: block;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h2>FINSA Admin Panel</h2>
    <button class="logout-btn" onclick="logoutUser()">Logout</button>
  </header>

  <div class="tabs">
    <button class="tab-link active" data-tab="home">Home</button>
    <button class="tab-link" data-tab="announcements">Announcements</button>
    <button class="tab-link" data-tab="events">Events</button>
    <button class="tab-link" data-tab="cbt">CBT</button>
    <button class="tab-link" data-tab="lostfound">Lost & Found</button>
    <button class="tab-link" data-tab="leaderboard">Leaderboard</button>
    <button class="tab-link" data-tab="feedback">Feedback</button>
    <button class="tab-link" data-tab="downloads">Downloads</button>
    <button class="tab-link" data-tab="settings">Settings</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCH5H1FWEcHmQiCQhoc6GE8GhizqhTZoQc",
      authDomain: "finsa-connect.firebaseapp.com",
      projectId: "finsa-connect",
      storageBucket: "finsa-connect.appspot.com",
      messagingSenderId: "126845965255",
      appId: "1:126845965255:web:c82539297a8464873d7fe2"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    auth.onAuthStateChanged(async (user) => {
      if (!user) return window.location.href = "/login.html";
      const doc = await db.collection("Users").doc(user.uid).get();
      if (!doc.exists || doc.data().role !== "admin") {
        alert("Access denied. Admins only.");
        return window.location.href = "/login.html";
      }
    });

    function logoutUser() {
      auth.signOut().then(() => {
        window.location.href = "/login.html";
      });
    }
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabs = document.querySelectorAll(".tab-link");
      const sections = document.querySelectorAll("section");

      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          tabs.forEach(t => t.classList.remove("active"));
          sections.forEach(s => s.classList.remove("active"));
          tab.classList.add("active");
          const target = document.getElementById(tab.dataset.tab);
          if (target) target.classList.add("active");
        });
      });
    });
  </script>
  <section id="home" class="active">
    <h3>Home Manager</h3>

    <div class="card">
      <h4>Add Finance Tip</h4>
      <textarea id="tipInput" rows="3" placeholder="Enter a new tip..." style="width: 100%; padding: 10px;"></textarea>
      <br><br>
      <button onclick="addFinanceTip()">Add Tip</button>
      <ul id="tipList"></ul>
    </div>

    <div class="card">
      <h4>Add Birthday</h4>
      <input type="text" id="bdayName" placeholder="Student's Name" style="padding: 8px; width: 48%;" />
      <input type="date" id="bdayDate" style="padding: 8px; width: 48%;" />
      <br><br>
      <button onclick="addBirthday()">Add Birthday</button>
      <ul id="birthdayList"></ul>
    </div>

    <div class="card">
      <h4>Upload Ad Banner</h4>
      <input type="file" id="adImage" accept="image/*" />
      <br><br>
      <img id="adPreview" src="" alt="Preview" style="max-height: 150px; display: none;" />
      <br><br>
      <input type="text" id="adLink" placeholder="Ad redirect link (optional)" style="width: 60%; padding: 8px;" />
      <br><br>
      <button onclick="uploadAd()">Upload Ad</button>
    </div>
  </section>

  <script>
    async function addFinanceTip() {
      const text = document.getElementById('tipInput').value.trim();
      if (!text) return alert('Tip cannot be empty');
      await db.collection('financeTips').add({ text });
      alert('Tip added!');
      document.getElementById('tipInput').value = '';
    }

    async function addBirthday() {
      const name = document.getElementById('bdayName').value.trim();
      const date = document.getElementById('bdayDate').value;
      if (!name || !date) return alert('Name and date required');
      await db.collection('birthdays').add({ name, date });
      alert('Birthday saved!');
      document.getElementById('bdayName').value = '';
      document.getElementById('bdayDate').value = '';
    }

    const fileInput = document.getElementById('adImage');
    const preview = document.getElementById('adPreview');

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    async function uploadAd() {
      const file = fileInput.files[0];
      const link = document.getElementById('adLink').value.trim();
      if (!file) return alert('Select an image');
      const filename = `ads/${Date.now()}-${file.name}`;
      const ref = storage.ref().child(filename);
      await ref.put(file);
      const url = await ref.getDownloadURL();
      await db.collection('ads').add({ imageUrl: url, link });
      alert('Ad uploaded!');
      fileInput.value = '';
      document.getElementById('adLink').value = '';
      preview.style.display = 'none';
    }
  </script>
  <section id="announcements">
    <h3>Announcements</h3>

    <div class="card">
      <h4>New Announcement</h4>
      <textarea id="announceInput" rows="3" placeholder="Type announcement..." style="width: 100%; padding: 10px;"></textarea>
      <br><br>
      <button onclick="postAnnouncement()">Post Announcement</button>
    </div>

    <div class="card">
      <h4>Posted Announcements</h4>
      <ul id="announcementList" style="list-style: none; padding-left: 0;"></ul>
    </div>
  </section>

  <script>
    async function postAnnouncement() {
      const text = document.getElementById("announceInput").value.trim();
      if (!text) return alert("Cannot post empty announcement.");
      await db.collection("announcements").add({ text, timestamp: Date.now() });
      alert("Announcement posted!");
      document.getElementById("announceInput").value = '';
    }
  </script>
  <section id="events">
    <h3>Events</h3>

    <div class="card">
      <h4>Create New Event</h4>
      <input type="text" id="eventTitle" placeholder="Event Title" style="width: 100%; padding: 8px;" />
      <br><br>
      <textarea id="eventDescription" rows="3" placeholder="Event Description..." style="width: 100%; padding: 8px;"></textarea>
      <br><br>
      <input type="date" id="eventDate" style="padding: 8px;" />
      <br><br>
      <button onclick="addEvent()">Add Event</button>
    </div>

    <div class="card">
      <h4>Upcoming Events</h4>
      <ul id="eventList"></ul>
    </div>
  </section>

  <script>
    async function addEvent() {
      const title = document.getElementById('eventTitle').value.trim();
      const description = document.getElementById('eventDescription').value.trim();
      const date = document.getElementById('eventDate').value;
      if (!title || !description || !date) return alert('All fields are required.');
      await db.collection("events").add({ title, description, date });
      alert("Event added!");
      document.getElementById('eventTitle').value = '';
      document.getElementById('eventDescription').value = '';
      document.getElementById('eventDate').value = '';
    }
  </script>
  <section id="cbt">
    <h3>CBT Manager</h3>

    <div class="card">
      <h4>Upload Question</h4>
      <input type="text" id="cbtSubject" placeholder="Subject (e.g. Economics)" style="width: 100%; padding: 8px;" />
      <br><br>
      <textarea id="cbtQuestion" rows="3" placeholder="Enter question..." style="width: 100%; padding: 8px;"></textarea>
      <br><br>
      <input type="text" id="optionA" placeholder="Option A" style="width: 48%; padding: 8px;" />
      <input type="text" id="optionB" placeholder="Option B" style="width: 48%; padding: 8px;" />
      <br><br>
      <input type="text" id="optionC" placeholder="Option C" style="width: 48%; padding: 8px;" />
      <input type="text" id="optionD" placeholder="Option D" style="width: 48%; padding: 8px;" />
      <br><br>
      <input type="text" id="correctAnswer" placeholder="Correct Option (A/B/C/D)" style="width: 100%; padding: 8px;" />
      <br><br>
      <button onclick="addCBTQuestion()">Upload Question</button>
    </div>
  </section>

  <script>
    async function addCBTQuestion() {
      const subject = document.getElementById('cbtSubject').value.trim();
      const question = document.getElementById('cbtQuestion').value.trim();
      const A = document.getElementById('optionA').value.trim();
      const B = document.getElementById('optionB').value.trim();
      const C = document.getElementById('optionC').value.trim();
      const D = document.getElementById('optionD').value.trim();
      const correct = document.getElementById('correctAnswer').value.trim().toUpperCase();

      if (!subject || !question || !A || !B || !C || !D || !['A','B','C','D'].includes(correct)) {
        return alert('Fill all fields properly and set correct answer as A, B, C, or D.');
      }

      await db.collection("cbt").add({
        subject, question, A, B, C, D, correct
      });

      alert("CBT question uploaded!");
      ['cbtSubject', 'cbtQuestion', 'optionA', 'optionB', 'optionC', 'optionD', 'correctAnswer']
        .forEach(id => document.getElementById(id).value = '');
    }
  </script>
  <section id="lostfound">
    <h3>Lost & Found</h3>

    <div class="card">
      <h4>Review Submissions</h4>
      <ul id="lostFoundList"></ul>
    </div>
  </section>

  <script>
    async function loadLostFound() {
      const list = document.getElementById("lostFoundList");
      list.innerHTML = '';
      const snapshot = await db.collection("lostfound").get();
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = doc.data().item || "Unnamed Item";
        list.appendChild(li);
      });
    }

    document.querySelector('[data-tab="lostfound"]').addEventListener("click", loadLostFound);
  </script>
  <section id="leaderboard">
    <h3>Leaderboard</h3>

    <div class="card">
      <h4>Top Scorers</h4>
      <ul id="leaderboardList"></ul>
    </div>
  </section>

  <script>
    async function loadLeaderboard() {
      const list = document.getElementById("leaderboardList");
      list.innerHTML = '';
      const snapshot = await db.collection("leaderboard").orderBy("score", "desc").limit(10).get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${data.name} - ${data.score} pts`;
        list.appendChild(li);
      });
    }

    document.querySelector('[data-tab="leaderboard"]').addEventListener("click", loadLeaderboard);
  </script>
  <section id="feedback">
    <h3>Feedback</h3>

    <div class="card">
      <h4>Student Feedback</h4>
      <ul id="feedbackList"></ul>
    </div>
  </section>

  <script>
    async function loadFeedback() {
      const list = document.getElementById("feedbackList");
      list.innerHTML = '';
      const snapshot = await db.collection("feedback").orderBy("timestamp", "desc").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${data.name || "Anonymous"}: ${data.message}`;
        list.appendChild(li);
      });
    }

    document.querySelector('[data-tab="feedback"]').addEventListener("click", loadFeedback);
  </script>
  <section id="downloads">
    <h3>Downloads</h3>

    <div class="card">
      <h4>Upload Material</h4>
      <input type="file" id="fileUpload" />
      <br><br>
      <input type="text" id="fileName" placeholder="File name or description" style="width: 100%; padding: 8px;" />
      <br><br>
      <button onclick="uploadFile()">Upload</button>
    </div>

    <div class="card">
      <h4>Uploaded Materials</h4>
      <ul id="downloadList"></ul>
    </div>
  </section>

  <script>
    async function uploadFile() {
      const file = document.getElementById("fileUpload").files[0];
      const name = document.getElementById("fileName").value.trim();
      if (!file || !name) return alert("Please select a file and enter a name.");
      const ref = storage.ref("downloads/" + file.name);
      await ref.put(file);
      const url = await ref.getDownloadURL();
      await db.collection("downloads").add({ name, url });
      alert("File uploaded!");
      document.getElementById("fileUpload").value = '';
      document.getElementById("fileName").value = '';
    }

    async function loadDownloads() {
      const list = document.getElementById("downloadList");
      list.innerHTML = '';
      const snapshot = await db.collection("downloads").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.innerHTML = `<a href="${data.url}" target="_blank">${data.name}</a>`;
        list.appendChild(li);
      });
    }

    document.querySelector('[data-tab="downloads"]').addEventListener("click", loadDownloads);
  </script>
  <section id="settings">
    <h3>Admin Settings</h3>

    <div class="card">
      <p>You can add custom admin settings here later like updating banner, password reset, etc.</p>
    </div>
  </section>

  <script>
    // Tab switching logic
    const tabs = document.querySelectorAll('.tab-link');
    const sections = document.querySelectorAll('section');

    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(b => b.classList.remove('active'));
        sections.forEach(sec => sec.classList.remove('active'));

        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });
  </script>
  <script>
    const app = firebase.initializeApp({
      apiKey: "AIzaSyCH5H1FWEcHmQiCQhoc6GE8GhizqhTZoQc",
      authDomain: "finsa-connect.firebaseapp.com",
      projectId: "finsa-connect",
      storageBucket: "finsa-connect.appspot.com",
      messagingSenderId: "126845965255",
      appId: "1:126845965255:web:c82539297a8464873d7fe2"
    });

    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    auth.onAuthStateChanged(async user => {
      if (!user) return window.location.href = 'email-login.html';

      const doc = await db.collection("Users").doc(user.uid).get();
      if (!doc.exists || doc.data().role !== "admin") {
        alert("Access denied.");
        auth.signOut();
        window.location.href = "email-login.html";
      }
    });

    function logoutUser() {
      auth.signOut().then(() => {
        window.location.href = "email-login.html";
      });
    }
  </script>
  </body>
</html>
