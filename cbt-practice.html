<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CBT Practice</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #000 url('https://cdn.jsdelivr.net/gh/Julian-Nash/assets@main/tech-background.gif') center/cover no-repeat;
      color: gold;
    }
    header {
      background-color: rgba(20, 20, 20, 0.95);
      padding: 15px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 0 10px gold;
      position: relative;
    }
    .calculator-icon {
      position: absolute;
      right: 15px;
      top: 15px;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      background: rgba(20, 20, 20, 0.9);
      border-radius: 10px;
      box-shadow: 0 0 10px gold;
    }
    .question-box {
      margin-bottom: 20px;
    }
    .option-btn {
      display: block;
      width: 100%;
      background: #222;
      border: 1px solid gold;
      color: gold;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .option-btn.selected {
      background: gold;
      color: black;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .nav-buttons button {
      padding: 10px 20px;
      border: none;
      background: gold;
      color: black;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }
    .timer-box {
      background: black;
      color: gold;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-size: 1.3rem;
      margin-bottom: 20px;
      border: 2px solid gold;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
    .submit-btn {
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: bold;
      background: gold;
      color: black;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
    #calculatorBox {
      display: none;
      margin-top: 20px;
      border: 2px solid gold;
      border-radius: 8px;
      overflow: hidden;
      height: 350px;
    }
    #calculatorBox iframe {
      width: 100%;
      height: 100%;
      background: black;
    }
  </style>
</head>
<body>
  <header>
    CBT Practice - Finance Point
    <i class="fas fa-calculator calculator-icon" onclick="toggleCalculator()" title="Show Calculator"></i>
  </header>
  <div class="container">
    <div id="timer" class="timer-box">Time: 30:00</div>
    <div id="question-container" class="question-box">Loading question...</div>
    <div class="nav-buttons">
      <button onclick="prevQuestion()">Previous</button>
      <button onclick="nextQuestion()">Next</button>
    </div>
    <div style="text-align: center;">
      <button class="submit-btn" onclick="submitQuiz()">Submit</button>
    </div>
    <div id="calculatorBox">
      <iframe src="https://mathsbot.com/questions/iqa" title="Basic Calculator"></iframe>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let questions = [];
let currentIndex = 0;
let answers = {};

async function loadQuestions() {
  const querySnapshot = await getDocs(collection(db, "cbtQuestions"));
  querySnapshot.forEach((doc) => {
    questions.push(doc.data());
  });
  questions = questions.sort(() => 0.5 - Math.random()).slice(0, 30);
  displayQuestion();
}

function displayQuestion() {
  const q = questions[currentIndex];
  if (!q) return;
  const container = document.getElementById("question-container");
  container.innerHTML = `
    <h3>Question ${currentIndex + 1}:</h3>
    <p>${q.question}</p>
    ${["A", "B", "C", "D"].map(opt => `
      <button class="option-btn ${answers[currentIndex] === opt ? 'selected' : ''}" onclick="selectAnswer('${opt}')">${opt}. ${q[opt]}</button>
    `).join("")}
  `;
}

window.selectAnswer = (option) => {
  answers[currentIndex] = option;
  displayQuestion();
  setTimeout(() => {
    if (currentIndex < questions.length - 1) {
      currentIndex++;
      displayQuestion();
    }
  }, 250);
};

window.nextQuestion = () => {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    displayQuestion();
  }
};

window.prevQuestion = () => {
  if (currentIndex > 0) {
    currentIndex--;
    displayQuestion();
  }
};

window.submitQuiz = () => {
  if (Object.keys(answers).length === 0) {
    alert("You haven't answered any questions.");
    return;
  }

  const container = document.getElementById("question-container");
  let score = 0;
  let missed = [];

  questions.forEach((q, i) => {
    if (answers[i] === q.correct) {
      score++;
    } else {
      missed.push({ number: i + 1, correct: q[q.correct] });
    }
  });

  const percent = Math.round((score / questions.length) * 100);

  container.innerHTML = `
    <h2>ðŸŽ‰ CBT Completed</h2>
    <p><strong>Total Score:</strong> ${score} / ${questions.length} (${percent}%)</p>
    <p><strong>Missed Questions:</strong></p>
    <ul style="text-align: left;">
      ${missed.map(m => `<li>Question ${m.number}: Correct Answer - ${m.correct}</li>`).join('') || '<li>None</li>'}
    </ul>
  `;

  document.querySelector(".nav-buttons").style.display = "none";
  document.getElementById("timer").style.display = "none";
  document.querySelector(".submit-btn").style.display = "none";

  onAuthStateChanged(auth, user => {
    if (user) {
      const result = {
        userId: user.uid,
        email: user.email,
        score,
        percent,
        total: questions.length,
        timestamp: new Date().toISOString()
      };
      addDoc(collection(db, "cbt_results"), result)
        .then(() => console.log("Result saved"))
        .catch(err => console.error("Failed to save result", err));
    }
  });
};

// Timer Logic
let timeLeft = 30 * 60;
const timerEl = document.getElementById("timer");
const timerInterval = setInterval(() => {
  const minutes = Math.floor(timeLeft / 60);
  const seconds = timeLeft % 60;
  timerEl.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, "0")}`;
  if (timeLeft <= 0) {
    clearInterval(timerInterval);
    alert("Time is up! Submitting quiz...");
    window.submitQuiz();
  }
  timeLeft--;
}, 1000);

loadQuestions();

  </script>
  <script>
    function toggleCalculator() {
      const calc = document.getElementById("calculatorBox");
      calc.style.display = (calc.style.display === "block") ? "none" : "block";
    }
  </script>
</body>
</html>
