<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CBT Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #000 url('https://cdn.jsdelivr.net/gh/Julian-Nash/assets@main/tech-background.gif') center/cover no-repeat;
      color: gold;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: rgba(20, 20, 20, 0.95);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      box-shadow: 0 0 10px gold;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    h1 {
      font-size: 1.8rem;
    }
    .nav-container {
      background: #111;
      padding: 10px;
      display: flex;
      justify-content: space-around;
      border-bottom: 2px solid gold;
      box-shadow: 0 2px 4px rgba(255, 215, 0, 0.2);
    }
    .nav-container a {
      color: gold;
      text-decoration: none;
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 5px;
      transition: 0.3s;
    }
    .nav-container a.active {
      background: gold;
      color: black;
      pointer-events: none;
    }
    .container {
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    .question-box {
      background: rgba(20, 20, 20, 0.85);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px gold;
    }
    .question-box h2 {
      font-size: 1.2rem;
      margin-bottom: 15px;
    }
    .options button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      background: #222;
      border: 1px solid gold;
      color: gold;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
    }
    .options button:hover {
      background: gold;
      color: black;
    }
    .summary {
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px gold;
      margin-top: 20px;
    }
    .summary h3 {
      margin-bottom: 10px;
    }
    .summary ul {
      list-style: none;
      padding: 0;
    }
    .summary li {
      margin: 5px 0;
      border-bottom: 1px dashed gold;
      padding-bottom: 5px;
    }
    .summary button {
      margin: 10px 10px 0 0;
      padding: 10px 16px;
      font-size: 1rem;
      background: gold;
      color: black;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <h1>FINANCE POINT</h1>
  <i class="fas fa-sign-out-alt logout-icon" onclick="logoutUser()" title="Logout"></i>
</header>

<!-- Top navigation bar -->
<div class="nav-container">
  <a href="home.html">Home</a>
  <a href="announcement-events.html">Announcements</a>
  <a href="downloads.html">Downloads</a>
  <a href="cbt.html" class="active">CBT</a>
  <a href="leaderboard.html">Leaderboard</a>
  <a href="feedback.html">Feedback</a>
  <a href="lostfound.html">Lost & Found</a>
</div>

<div class="container" id="cbtArea"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, setDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH5H1FWEcHmQiCQhoc6GE8GhizqhTZoQc",
    authDomain: "finsa-connect.firebaseapp.com",
    projectId: "finsa-connect",
    storageBucket: "finsa-connect.appspot.com",
    messagingSenderId: "126845965255",
    appId: "1:126845965255:web:c82539297a8464873d7fe2"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const questions = [
    { q: "What does CPU stand for?", a: "Central Processing Unit", b: "Computer Power Unit", c: "Core Program Utility", d: "Central Programming Unit", correct: "a" },
    { q: "What is the full meaning of ATM?", a: "Automated Teller Machine", b: "Automatic Transfer Machine", c: "Auto Teller Mechanism", d: "Account Transfer Method", correct: "a" },
    { q: "Which planet is closest to the sun?", a: "Venus", b: "Earth", c: "Mercury", d: "Mars", correct: "c" },
    { q: "What is 15% of 200?", a: "25", b: "30", c: "35", d: "40", correct: "b" },
    { q: "Which company owns Android?", a: "Apple", b: "Google", c: "Samsung", d: "Microsoft", correct: "b" },
    { q: "Which document summarizes a company’s assets and liabilities?", a: "Balance Sheet", b: "Income Statement", c: "Bank Statement", d: "Invoice", correct: "a" },
    { q: "Who wrote 'Things Fall Apart'?", a: "Wole Soyinka", b: "Chimamanda Adichie", c: "Chinua Achebe", d: "Ngũgĩ wa Thiong'o", correct: "c" },
    { q: "Which is not a type of bank account?", a: "Savings", b: "Current", c: "Fixed", d: "Private", correct: "d" },
    { q: "Which organ filters blood?", a: "Liver", b: "Heart", c: "Lungs", d: "Kidney", correct: "d" },
    { q: "How many sides does a hexagon have?", a: "5", b: "6", c: "7", d: "8", correct: "b" },
    { q: "Which of these is not an OS?", a: "Linux", b: "Windows", c: "Google", d: "macOS", correct: "c" },
    // More questions (add up to 30)...
  ];

  let index = 0, score = 0;
  let currentUser = null;
  const container = document.getElementById("cbtArea");

  function loadQuestion() {
    if (index >= questions.length) return showSummary();
    const q = questions[index];
    container.innerHTML = `
      <div class="question-box">
        <h2>Question ${index + 1} of ${questions.length}</h2>
        <p>${q.q}</p>
        <div class="options">
          ${["a", "b", "c", "d"].map(opt =>
            `<button onclick="checkAnswer('${opt}')">${q[opt]}</button>`
          ).join("")}
        </div>
      </div>
    `;
  }

  window.checkAnswer = (choice) => {
    if (choice === questions[index].correct) score++;
    index++;
    loadQuestion();
  }

  async function showSummary() {
    container.innerHTML = `
      <div class="summary">
        <h3>Quiz Completed!</h3>
        <p>Score: ${score}/${questions.length}</p>
        <h4>Correct Answers:</h4>
        <ul>
          ${questions.map((q, i) => `<li>${i + 1}. ${q.q} <br> <strong>${q[q.correct]}</strong></li>`).join("")}
        </ul>
        <button onclick="window.location.href='home.html'">Return Home</button>
        <button disabled>Retake Quiz (wait 3 mins)</button>
      </div>
    `;

    const ref = doc(db, "cbt_scores", currentUser.uid + "_" + Date.now());
    await setDoc(ref, {
      userId: currentUser.uid,
      fullName: currentUser.displayName || "User",
      matricNumber: sessionStorage.getItem("userMatric") || "Unknown",
      score,
      total: questions.length,
      timestamp: serverTimestamp()
    });

    const userRef = doc(db, "users", currentUser.uid);
    await updateDoc(userRef, { lastCBT: serverTimestamp() });
  }

  onAuthStateChanged(auth, user => {
    if (!user) return window.location.href = "login.html";
    currentUser = user;
    loadQuestion();
  });

  window.logoutUser = function () {
    signOut(auth).then(() => window.location.href = "login.html");
  }
</script>
</body>
</html>
