<!-- ✅ Chunk 1: Layout & Style --><!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CBT Practice</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #000 url('https://cdn.jsdelivr.net/gh/Julian-Nash/assets@main/tech-background.gif') center/cover no-repeat;
      color: gold;
    }
    header {
      background-color: rgba(20, 20, 20, 0.95);
      padding: 15px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 0 10px gold;
      position: relative;
    }
    .back-btn {
      position: absolute;
      left: 15px;
      top: 15px;
      font-size: 1.2rem;
      color: gold;
      cursor: pointer;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      background: rgba(20, 20, 20, 0.9);
      border-radius: 10px;
      box-shadow: 0 0 10px gold;
    }
    .question-box {
      margin-bottom: 20px;
    }
    .option-btn {
      display: block;
      width: 100%;
      background: #222;
      border: 1px solid gold;
      color: gold;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .option-btn.selected {
      background: gold;
      color: black;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .nav-buttons button {
      padding: 10px 20px;
      border: none;
      background: gold;
      color: black;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }
    .timer {
      text-align: center;
      font-size: 1.3rem;
      background: #111;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid gold;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
    #calculatorBox {
      display: none;
      margin-top: 20px;
      border: 2px solid gold;
      border-radius: 8px;
      overflow: hidden;
    }
    #calculatorBox iframe {
      width: 100%;
      height: 300px;
      background: black;
    }
    #submitBtn {
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: bold;
      background: gold;
      color: black;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <i class="fas fa-arrow-left back-btn" onclick="window.location.href='home.html'"></i>
    CBT Practice - Finance Point
  </header>
  <div class="container">
    <div class="timer" id="timer">Time: 30:00</div>
    <div id="question-container" class="question-box">
      Loading question...
    </div>
    <div class="nav-buttons">
      <button onclick="prevQuestion()">Previous</button>
      <button onclick="nextQuestion()">Next</button>
    </div>
    <div style="text-align: center; margin-top: 30px;">
      <button id="submitBtn" onclick="submitQuiz()">Submit</button>
    </div>
    <div id="calculatorBox">
      <iframe srcdoc="
        <html>
          <body style='margin:0;background:black;color:gold;font-family:sans-serif;'>
            <div style='text-align:center;margin:10px;'>Basic Calculator</div>
            <input type='text' id='screen' style='width:90%;padding:10px;border-radius:5px;margin-bottom:10px;'>
            <div style='display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:10px;'>
              ${[7,8,9,'/'].map(x => `<button onclick='press("${x}")'>${x}</button>`).join('')}
              ${[4,5,6,'*'].map(x => `<button onclick='press("${x}")'>${x}</button>`).join('')}
              ${[1,2,3,'-'].map(x => `<button onclick='press("${x}")'>${x}</button>`).join('')}
              ${[0,'.','=','+'].map(x => `<button onclick='press("${x}")'>${x}</button>`).join('')}
              <button onclick='document.getElementById("screen").value=""' style='grid-column:span 4;'>C</button>
            </div>
            <script>
              function press(val){
                const s=document.getElementById('screen');
                if(val==='='){s.value=eval(s.value)}else{s.value+=val}
              }
            </script>
          </body>
        </html>" title="Calculator"></iframe>
    </div>
  </div>
  <script>
    function toggleCalculator() {
      const calcBox = document.getElementById("calculatorBox");
      calcBox.style.display = (calcBox.style.display === "block") ? "none" : "block";
    }
  </script>
  <!-- Chunk 2 will continue here -->
</body>
</html>
// ✅ CBT Practice: Chunk 2 - Quiz Logic & Dummy Questions

<script>
const questions = [
  {
    question: "What is the full meaning of CBT?",
    options: ["Computer-Based Test", "Central Bank Test", "Coded Banking Technology", "Current Bank Terms"],
    answer: 0
  },
  {
    question: "Which of the following is a financial institution?",
    options: ["WAEC", "NECO", "CBN", "NCDC"],
    answer: 2
  },
  {
    question: "The acronym ATM stands for?",
    options: ["All Time Money", "Automatic Teller Machine", "Access Transfer Method", "Automated Transaction Mechanism"],
    answer: 1
  },
  {
    question: "In finance, ROI means?",
    options: ["Return on Investment", "Rate of Interest", "Revenue on Input", "Record of Income"],
    answer: 0
  },
  {
    question: "Which one is NOT a Nigerian commercial bank?",
    options: ["First Bank", "GTBank", "UBA", "Tesla Bank"],
    answer: 3
  }
];

let currentIndex = 0;
let selectedAnswers = {};
let timeLeft = 30 * 60;
let timerInterval;

function renderQuestion() {
  const question = questions[currentIndex];
  const container = document.getElementById("question-container");
  container.innerHTML = `
    <h3>Question ${currentIndex + 1} of ${questions.length}</h3>
    <p>${question.question}</p>
    ${question.options.map((opt, i) => `
      <button class="option-btn ${selectedAnswers[currentIndex] === i ? 'selected' : ''}" onclick="selectAnswer(${i})">${opt}</button>
    `).join('')}
  `;
}

function selectAnswer(index) {
  selectedAnswers[currentIndex] = index;
  renderQuestion();
  setTimeout(() => {
    if (currentIndex < questions.length - 1) {
      currentIndex++;
      renderQuestion();
    }
  }, 200);
}

function nextQuestion() {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    renderQuestion();
  }
}

function prevQuestion() {
  if (currentIndex > 0) {
    currentIndex--;
    renderQuestion();
  }
}

function submitQuiz() {
  const container = document.getElementById("question-container");
  let score = 0;
  let missed = [];

  questions.forEach((q, i) => {
    if (selectedAnswers[i] === q.answer) {
      score++;
    } else {
      missed.push(`Question ${i + 1}: Correct Answer - ${q.options[q.answer]}`);
    }
  });

  const percent = Math.round((score / questions.length) * 100);
  container.innerHTML = `
    <h2>🎉 CBT Completed</h2>
    <p><strong>Total Score:</strong> ${score} / ${questions.length} (${percent}%)</p>
    <ul style="text-align:left;">${missed.map(m => `<li>${m}</li>`).join('')}</ul>
  `;

  document.querySelector(".nav-buttons").style.display = "none";
  document.getElementById("timer").style.display = "none";
  document.getElementById("submitBtn").style.display = "none";
}

function startTimer() {
  const timerEl = document.getElementById("timer");
  timerInterval = setInterval(() => {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timerEl.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      alert("⏰ Time is up! Submitting...");
      submitQuiz();
    }
    timeLeft--;
  }, 1000);
}

window.onload = () => {
  renderQuestion();
  startTimer();
};
</script>
<!-- ✅ Chunk 3 - Final Touches + Result Enhancements --><script>
function submitQuiz() {
  if (Object.keys(selectedAnswers).length === 0) {
    alert("You haven't answered any questions.");
    return;
  }

  const confirmSubmit = confirm("Are you sure you want to submit?");
  if (!confirmSubmit) return;

  clearInterval(timerInterval);
  calculateResult();
}

function calculateResult() {
  let score = 0;
  let missed = [];

  questions.forEach((q, i) => {
    if (selectedAnswers[i] === q.answer) {
      score++;
    } else {
      missed.push({ number: i + 1, correct: q.options[q.answer] });
    }
  });

  const percent = Math.round((score / questions.length) * 100);

  const container = document.getElementById("question-container");
  container.innerHTML = `
    <h2>🎉 CBT Completed</h2>
    <p><strong>Total Score:</strong> ${score} / ${questions.length} (${percent}%)</p>
    <p><strong>Missed Questions:</strong></p>
    <ul style="text-align: left;">
      ${missed.map(m => `<li>Question ${m.number}: Correct Answer - ${m.correct}</li>`).join('') || '<li>None</li>'}
    </ul>
  `;

  document.querySelector(".nav-buttons").style.display = "none";
  document.getElementById("timer").style.display = "none";
  document.querySelector("#submitBtn").style.display = "none";

  // Optional: Save to Firestore if user is authenticated
  // saveResultToFirestore(score, percent);
}
</script><!-- ✅ End of Chunk 3 -->
<!-- ✅ Chunk 4 - Sample Questions for CBT -->
<script>
const questions = [
  {
    text: "What is the full meaning of CBN?",
    options: ["Central Bank of Nigeria", "Commercial Bank Network", "Currency Bureau of Nigeria", "Central Banking of Nations"],
    answer: 0
  },
  {
    text: "Who is the current Minister of Finance in Nigeria (as of 2025)?",
    options: ["Zainab Ahmed", "Wale Edun", "Ngozi Okonjo-Iweala", "Akinwumi Adesina"],
    answer: 1
  },
  {
    text: "What does ATM stand for?",
    options: ["Automated Teller Machine", "All-Time Money", "Automatic Transfer Method", "Access To Money"],
    answer: 0
  },
  {
    text: "Which of the following is **NOT** a function of commercial banks?",
    options: ["Granting Loans", "Currency Printing", "Accepting Deposits", "Issuing Cheque Books"],
    answer: 1
  },
  {
    text: "What is liquidity in finance?",
    options: ["The ability to make profit", "The rate of inflation", "Ease of converting assets to cash", "Government revenue"],
    answer: 2
  }
];

let currentIndex = 0;
let selectedAnswers = {};

function renderQuestion() {
  const q = questions[currentIndex];
  const container = document.getElementById("question-container");
  container.innerHTML = `
    <div><strong>Question ${currentIndex + 1} of ${questions.length}</strong></div>
    <div style="margin: 10px 0;">${q.text}</div>
    ${q.options.map((opt, i) => `
      <button class="option-btn${selectedAnswers[currentIndex] === i ? ' selected' : ''}" onclick="selectAnswer(${i})">${opt}</button>
    `).join('')}
  `;
}

function selectAnswer(index) {
  selectedAnswers[currentIndex] = index;
  renderQuestion();
  setTimeout(() => {
    if (currentIndex < questions.length - 1) {
      currentIndex++;
      renderQuestion();
    }
  }, 250);
}

function prevQuestion() {
  if (currentIndex > 0) {
    currentIndex--;
    renderQuestion();
  }
}

function nextQuestion() {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    renderQuestion();
  }
}

// Call this on page load
window.addEventListener('load', renderQuestion);
</script>
<!-- ✅ End of Chunk 4 -->
<!-- ✅ Chunk 5 - Timer, Submit Button Styling & Calculator Toggle -->
<script>
let timeLeft = 30 * 60; // 30 minutes
const timerEl = document.getElementById("timer");

const timerInterval = setInterval(() => {
  const minutes = Math.floor(timeLeft / 60);
  const seconds = timeLeft % 60;
  timerEl.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, "0")}`;
  if (timeLeft <= 0) {
    clearInterval(timerInterval);
    alert("Time is up! Submitting quiz...");
    submitQuiz();
  }
  timeLeft--;
}, 1000);
</script>

<!-- Optional Styling Improvements -->
<script>
  // Add styling class to timer
  timerEl.classList.add("timer-box");

  // Enhance submit button appearance
  const submitBtn = document.getElementById("submitBtn");
  if (submitBtn) {
    submitBtn.classList.add("submit-btn");
  }
</script>

<!-- Calculator Toggle Button Fix -->
<script>
  function toggleCalculator() {
    const calcBox = document.getElementById("calculatorBox");
    if (!calcBox) return;
    calcBox.style.display = (calcBox.style.display === "block") ? "none" : "block";
  }
</script>
<!-- ✅ Chunk 6 - Firestore Result Saving, UX Fallbacks -->
<script type="module">
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const db = getFirestore();
  const auth = getAuth();

  // 👇 Add this only if not already declared earlier
  // const app = initializeApp(firebaseConfig); (already done in chunk 1)

  function saveResultToFirestore(score, percent) {
    onAuthStateChanged(auth, async (user) => {
      if (!user) return console.warn("Not logged in, result won't be saved.");

      const result = {
        userId: user.uid,
        email: user.email,
        score,
        percent,
        total: questions.length,
        timestamp: new Date().toISOString()
      };

      try {
        await addDoc(collection(db, "cbt_results"), result);
        console.log("Result saved successfully.");
      } catch (err) {
        console.error("Failed to save result:", err);
      }
    });
  }

  // Modify your calculateResult function to call this
  window.calculateResult = function () {
    let score = 0;
    let missed = [];

    questions.forEach((q, i) => {
      if (selectedAnswers[i] === q.answer) {
        score++;
      } else {
        missed.push({ number: i + 1, correct: q.options[q.answer] });
      }
    });

    const percent = Math.round((score / questions.length) * 100);

    const container = document.getElementById("question-container");
    container.innerHTML = `
      <h2>🎉 CBT Completed</h2>
      <p><strong>Total Score:</strong> ${score} / ${questions.length} (${percent}%)</p>
      <p><strong>Missed Questions:</strong></p>
      <ul style="text-align: left;">
        ${missed.map(m => `<li>Question ${m.number}: Correct Answer - ${m.correct}</li>`).join('') || '<li>None</li>'}
      </ul>
    `;

    document.querySelector(".nav-buttons").style.display = "none";
    document.getElementById("timer").style.display = "none";
    document.querySelector("#submitBtn").style.display = "none";

    saveResultToFirestore(score, percent);
  };
</script>

<!-- Optional Fallback for No Questions -->
<script>
  window.addEventListener("load", () => {
    const qBox = document.getElementById("question-container");
    setTimeout(() => {
      if (qBox && qBox.innerText.includes("Loading")) {
        qBox.innerHTML = `<p style="color:red;text-align:center;">⚠️ No questions loaded. Please check your database or refresh the page.</p>`;
      }
    }, 5000);
  });
</script>
