<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CBT Practice</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #000 url('https://cdn.jsdelivr.net/gh/Julian-Nash/assets@main/tech-background.gif') center/cover no-repeat;
      color: gold;
    }
    header {
      background-color: rgba(20, 20, 20, 0.95);
      padding: 15px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 0 10px gold;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      background: rgba(20, 20, 20, 0.9);
      border-radius: 10px;
      box-shadow: 0 0 10px gold;
    }
    .question-box {
      margin-bottom: 20px;
    }
    .option-btn {
      display: block;
      width: 100%;
      background: #222;
      border: 1px solid gold;
      color: gold;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .option-btn.selected {
      background: gold;
      color: black;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .nav-buttons button {
      padding: 10px 20px;
      border: none;
      background: gold;
      color: black;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }
    .timer {
      text-align: center;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .calculator {
      text-align: center;
      margin: 20px 0;
    }
    iframe {
      border: none;
      width: 100%;
      height: 300px;
      background: #fff;
    }
  </style>
</head>
<body>
  <header>CBT Practice - Finance Point</header>
  <div class="container">
    <div class="timer" id="timer">Time: 30:00</div>
    <div id="question-container" class="question-box">
      Loading question...
    </div>
    <div class="nav-buttons">
      <button onclick="prevQuestion()">Previous</button>
      <button onclick="nextQuestion()">Next</button>
    </div>
    <div style="text-align: center; margin-top: 30px;">
      <button onclick="submitQuiz()">Submit</button>
    </div>
    <div class="calculator">
      <h3>Calculator</h3>
      <iframe src="https://www.desmos.com/scientific" title="Calculator"></iframe>
    </div>
  </div>  <!-- Scripts will begin in Chunk 2 --></body>
</html>
<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CBT Practice</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #000 url('https://cdn.jsdelivr.net/gh/Julian-Nash/assets@main/tech-background.gif') center/cover no-repeat;
      color: gold;
    }
    header {
      background-color: rgba(20, 20, 20, 0.95);
      padding: 15px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 0 10px gold;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      background: rgba(20, 20, 20, 0.9);
      border-radius: 10px;
      box-shadow: 0 0 10px gold;
    }
    .question-box {
      margin-bottom: 20px;
    }
    .option-btn {
      display: block;
      width: 100%;
      background: #222;
      border: 1px solid gold;
      color: gold;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .option-btn.selected {
      background: gold;
      color: black;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .nav-buttons button {
      padding: 10px 20px;
      border: none;
      background: gold;
      color: black;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }
    .timer {
      text-align: center;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .calculator {
      text-align: center;
      margin: 20px 0;
    }
    iframe {
      border: none;
      width: 100%;
      height: 300px;
      background: #fff;
    }
  </style>
</head>
<body>
  <header>CBT Practice - Finance Point</header>
  <div class="container">
    <div class="timer" id="timer">Time: 30:00</div>
    <div id="question-container" class="question-box">
      Loading question...
    </div>
    <div class="nav-buttons">
      <button onclick="prevQuestion()">Previous</button>
      <button onclick="nextQuestion()">Next</button>
    </div>
    <div style="text-align: center; margin-top: 30px;">
      <button onclick="submitQuiz()">Submit</button>
    </div>
    <div class="calculator">
      <h3>Calculator</h3>
      <iframe src="https://www.desmos.com/scientific" title="Calculator"></iframe>
    </div>
  </div>  <!-- ‚úÖ Chunk 2 Begins -->  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH5H1FWEcHmQiCQhoc6GE8GhizqhTZoQc",
      authDomain: "finsa-connect.firebaseapp.com",
      projectId: "finsa-connect",
      storageBucket: "finsa-connect.appspot.com",
      messagingSenderId: "126845965255",
      appId: "1:126845965255:web:c82539297a8464873d7fe2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let questions = [];
    let currentIndex = 0;
    let selectedAnswers = {};
    let userUID = null;

    onAuthStateChanged(auth, async (user) => {
      if (!user) return window.location.href = "login.html";
      userUID = user.uid;
      const snapshot = await getDocs(collection(db, "cbt_questions"));
      questions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      shuffleArray(questions);
      renderQuestion();
      startTimer();
    });

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function renderQuestion() {
      const q = questions[currentIndex];
      if (!q) return;
      const container = document.getElementById("question-container");
      let html = `<h3>Q${currentIndex + 1}. ${q.question}</h3>`;
      for (const opt of q.options) {
        const selected = selectedAnswers[q.id] === opt ? 'selected' : '';
        html += `<button class="option-btn ${selected}" onclick="selectOption('${q.id}', '${opt}')">${opt}</button>`;
      }
      container.innerHTML = html;
    }

    window.selectOption = function (qid, selectedOpt) {
      selectedAnswers[qid] = selectedOpt;
      renderQuestion();
    };

    window.nextQuestion = function () {
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        renderQuestion();
      }
    };

    window.prevQuestion = function () {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
      }
    };

    window.submitQuiz = async function () {
      let correct = 0;
      let missed = [];
      questions.forEach(q => {
        if (selectedAnswers[q.id] === q.answer) correct++;
        else missed.push(q);
      });

      const score = Math.round((correct / questions.length) * 100);
      await setDoc(doc(db, "cbt_scores", userUID), {
        score,
        timestamp: new Date(),
        userId: userUID,
        total: questions.length,
        correct,
        missed: missed.map(m => m.id),
      });

      alert(`You scored ${score}%. Click OK to return.`);
      window.location.href = "home.html";
    };

    // Timer Setup
    function startTimer() {
      let totalSeconds = 30 * 60; // 30 minutes
      const timerEl = document.getElementById("timer");

      const interval = setInterval(() => {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        timerEl.textContent = `Time: ${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
        if (--totalSeconds < 0) {
          clearInterval(interval);
          submitQuiz();
        }
      }, 1000);
    }
  </script></body>
</html>
<!-- ‚úÖ Chunk 3: Firebase Setup & Quiz Fetching -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, collection, getDocs, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH5H1FWEcHmQiCQhoc6GE8GhizqhTZoQc",
    authDomain: "finsa-connect.firebaseapp.com",
    projectId: "finsa-connect",
    storageBucket: "finsa-connect.appspot.com",
    messagingSenderId: "126845965255",
    appId: "1:126845965255:web:c82539297a8464873d7fe2"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let questions = [];
  let currentQuestion = 0;
  let userAnswers = [];
  let quizStarted = false;

  const questionContainer = document.getElementById("question-container");

  onAuthStateChanged(auth, async (user) => {
    if (!user) return window.location.href = "login.html";

    // Fetch quiz questions from Firestore
    const querySnapshot = await getDocs(collection(db, "cbt_questions"));
    querySnapshot.forEach((doc) => {
      questions.push({ id: doc.id, ...doc.data() });
    });

    // Randomize and trim to 30 questions
    questions = shuffleArray(questions).slice(0, 30);
    userAnswers = Array(questions.length).fill(null);

    displayQuestion();
    startTimer();
  });

  function shuffleArray(arr) {
    return arr
      .map(value => ({ value, sort: Math.random() }))
      .sort((a, b) => a.sort - b.sort)
      .map(({ value }) => value);
  }

  function displayQuestion() {
    const q = questions[currentQuestion];
    if (!q) return;

    questionContainer.innerHTML = `
      <h3>Q${currentQuestion + 1}: ${q.question}</h3>
      ${q.options.map((opt, index) => `
        <button class="option-btn ${userAnswers[currentQuestion] === index ? 'selected' : ''}"
          onclick="selectOption(${index})">${opt}</button>`).join("")}
    `;
  }

  window.selectOption = (index) => {
    userAnswers[currentQuestion] = index;
    displayQuestion();
  };

  window.nextQuestion = () => {
    if (currentQuestion < questions.length - 1) {
      currentQuestion++;
      displayQuestion();
    }
  };

  window.prevQuestion = () => {
    if (currentQuestion > 0) {
      currentQuestion--;
      displayQuestion();
    }
  };
</script>
<!-- ‚úÖ End of Chunk 3 -->
<!-- ‚úÖ Chunk 4: Timer, Submission, Result Display & Firestore Save -->
<script type="module">
  let timeLeft = 1800; // 30 minutes = 1800 seconds
  const timerDisplay = document.getElementById("timer");
  let timerInterval;

  function startTimer() {
    timerInterval = setInterval(() => {
      timeLeft--;
      const min = Math.floor(timeLeft / 60);
      const sec = timeLeft % 60;
      timerDisplay.textContent = `Time: ${min}:${sec < 10 ? "0" + sec : sec}`;

      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        submitQuiz(); // Auto submit
      }
    }, 1000);
  }

  window.submitQuiz = async () => {
    clearInterval(timerInterval);
    const user = auth.currentUser;
    if (!user) return alert("Not logged in");

    let score = 0;
    let wrong = 0;
    const summaryHTML = [];

    questions.forEach((q, index) => {
      const correctIndex = q.correct;
      const selected = userAnswers[index];

      if (selected === correctIndex) {
        score++;
      } else {
        wrong++;
      }

      summaryHTML.push(`
        <div style="border-bottom:1px solid gray; padding:10px;">
          <strong>Q${index + 1}: ${q.question}</strong><br>
          Your answer: ${selected !== null ? q.options[selected] : '<i>Not answered</i>'}<br>
          Correct answer: ${q.options[correctIndex]}
        </div>
      `);
    });

    // Save score to Firestore
    try {
      await setDoc(doc(db, "cbt_results", user.uid), {
        name: user.displayName || user.email,
        score,
        total: questions.length,
        submittedAt: serverTimestamp(),
        answers: userAnswers
      });
    } catch (err) {
      alert("Error saving result: " + err.message);
    }

    // Show result
    document.querySelector(".container").innerHTML = `
      <h2>Quiz Complete</h2>
      <p>‚úÖ Score: ${score}/${questions.length}</p>
      <p>‚ùå Wrong: ${wrong}</p>
      <h3>Answer Review</h3>
      <div style="text-align:left;">${summaryHTML.join("")}</div>
    `;
  };
</script>
<!-- ‚úÖ End of Chunk 4 -->
// ‚úÖ Chunk 5 ‚Äì Final Touches, Fallbacks, and Export Utility

<script>
// -------------------------
// Helper: Display fallback message if no question loaded
// -------------------------
function showIfEmpty(containerId, message = "Nothing to display.") {
  const box = document.getElementById(containerId);
  if (box && box.innerHTML.trim() === '') {
    box.innerHTML = `<p style="text-align:center; opacity:0.6;">${message}</p>`;
  }
}

// -------------------------
// Download Result Locally (Optional Admin Utility)
// -------------------------
function downloadResult(answers, score) {
  const result = {
    timestamp: new Date().toISOString(),
    answers,
    score
  };
  const blob = new Blob([JSON.stringify(result, null, 2)], { type: 'application/json' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'cbt_result.json';
  link.click();
  URL.revokeObjectURL(link.href);
}

// -------------------------
// Timer Visibility Safeguard (optional)
// -------------------------
window.addEventListener('load', () => {
  showIfEmpty("question-container", "Unable to load quiz. Check your network.");
});
</script><!-- ‚úÖ End of CBT Practice Setup --><!-- üîê Integrated with Firestore | Randomized Questions | Admin-ready -->
