<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Finance Point Dashboard</title>
<style>
  /* Background + font */
  body, html {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    background: url('https://cdn.jsdelivr.net/gh/VincentGarreau/particles.js/assets/img/background3.jpg') no-repeat center center fixed;
    background-size: cover;
    color: white;
  }
  header {
    background: rgba(255, 183, 0, 0.95);
    color: #000;
    padding: 1rem 2rem;
    font-weight: bold;
    font-size: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  nav {
    display: flex;
    flex-wrap: wrap;
    background: rgba(32, 58, 67, 0.9);
    padding: 0.5rem 1rem;
    align-items: center;
    gap: 10px;
    justify-content: center;
  }
  nav button.tab-btn {
    background: none;
    border: none;
    color: #fff;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s;
    border-radius: 4px;
    min-width: 100px;
  }
  nav button.tab-btn:hover,
  nav button.tab-btn.active {
    background: #ffb700;
    color: #000;
    font-weight: bold;
  }

  /* Logout below nav */
  #logoutWrapper {
    display: flex;
    justify-content: center;
    background: rgba(32, 58, 67, 0.9);
    padding: 0.75rem 0;
  }
  #logoutBtn {
    background: #ff4d4d;
    border: none;
    color: white;
    padding: 0.75rem 2rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease;
    max-width: 300px;
    width: 100%;
  }
  #logoutBtn:hover {
    background: #ff0000;
  }

  main {
    padding: 1rem 2rem;
    background: rgba(0,0,0,0.4);
    min-height: calc(100vh - 160px);
    overflow-y: auto;
  }

  section {
    display: none;
  }
  section.active {
    display: block;
  }

  /* Admin toggle */
  #adminToggleBtn {
    background: #ffb700;
    color: #000;
    border: none;
    padding: 0.5rem 1rem;
    font-weight: bold;
    border-radius: 5px;
    cursor: pointer;
    margin-left: auto;
  }
  #adminToggleBtn:hover {
    background: #ffa500;
  }

  label {
    display: block;
    margin: 1rem 0 0.3rem;
  }
  input, textarea {
    width: 100%;
    padding: 0.5rem;
    border-radius: 5px;
    border: none;
    font-size: 1rem;
  }
  button.submit-btn {
    margin-top: 1rem;
    background: #ffb700;
    color: #000;
    border: none;
    padding: 0.7rem 1.2rem;
    font-weight: bold;
    cursor: pointer;
    border-radius: 5px;
    transition: background 0.3s ease;
  }
  button.submit-btn:hover {
    background: #ffa500;
  }

  .message {
    margin-top: 1rem;
    font-weight: bold;
    color: #ffb700;
  }

  ul {
    list-style: none;
    padding: 0;
    margin-top: 1rem;
  }
  ul li {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.7rem;
    margin-bottom: 0.5rem;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }
  ul li button {
    background: #ffb700;
    border: none;
    padding: 0.3rem 0.7rem;
    margin-left: 5px;
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    color: #000;
    transition: background 0.3s ease;
  }
  ul li button:hover {
    background: #ffa500;
  }
</style>
</head>
<body>

<header>
  Finance Point Dashboard
  <button id="adminToggleBtn" style="display:none;">Show Admin Panel</button>
</header>

<nav id="tabsNav">
  <button class="tab-btn active" data-target="announcements">Announcements</button>
  <button class="tab-btn" data-target="events">Events</button>
  <button class="tab-btn" data-target="quizOfTheWeek">Quiz of the Week</button>
  <button class="tab-btn" data-target="birthdayWall">Birthday Wall</button>
  <button class="tab-btn" data-target="lostAndFound">Lost & Found</button>
  <button class="tab-btn" data-target="studyResources">Study Resources</button>
  <button class="tab-btn" data-target="feedbackBox">Feedback Box</button>
  <button class="tab-btn" data-target="financeChallenges">Finance Challenges</button>
  <!-- Admin tabs, hidden by default -->
  <button class="tab-btn admin-only" data-target="executives" style="display:none;">Manage Executives</button>
  <button class="tab-btn admin-only" data-target="users" style="display:none;">Manage Users</button>
</nav>

<div id="logoutWrapper">
  <button id="logoutBtn">Logout</button>
</div>

<main>
  <!-- General User Sections -->
  <section id="announcements" class="active">
    <h2>Announcements</h2>
    <ul id="announcementList"></ul>
  </section>

  <section id="events">
    <h2>Events</h2>
    <ul id="eventList"></ul>
  </section>

  <section id="quizOfTheWeek">
    <h2>Quiz of the Week</h2>
    <p>Coming soon...</p>
  </section>

  <section id="birthdayWall">
    <h2>Birthday Wall</h2>
    <ul id="birthdayList"></ul>
  </section>

  <section id="lostAndFound">
    <h2>Lost & Found</h2>
    <ul id="lostList"></ul>
  </section>

  <section id="studyResources">
    <h2>Study Resources</h2>
    <ul id="resourceList"></ul>
  </section>

  <section id="feedbackBox">
    <h2>Feedback Box</h2>
    <ul id="feedbackList"></ul>
  </section>

  <section id="financeChallenges">
    <h2>Finance Challenges</h2>
    <p>Coming soon...</p>
  </section>

  <!-- Admin Only Sections -->
  <section id="executives" style="display:none;">
    <h2>Manage Executives</h2>
    <label for="execName">Name:</label>
    <input type="text" id="execName" placeholder="Executive Name" />
    <label for="execRole">Role:</label>
    <input type="text" id="execRole" placeholder="Role (e.g. President)" />
    <button class="submit-btn" id="addExecBtn">Add Executive</button>
    <div id="execMessage" class="message"></div>
    <ul id="execList"></ul>
  </section>

  <section id="users" style="display:none;">
    <h2>Manage Users</h2>
    <ul id="userList"></ul>
    <div id="userMessage" class="message"></div>
  </section>

</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import {
    getAuth, signOut, onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
  import {
    getFirestore,
    collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, updateDoc
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH5H1FWEcHmQiCQhoc6GE8GhizqhTZoQc",
    authDomain: "finsa-connect.firebaseapp.com",
    projectId: "finsa-connect",
    storageBucket: "finsa-connect.firebasestorage.app",
    messagingSenderId: "126845965255",
    appId: "1:126845965255:web:c82539297a8464873d7fe2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // DOM elements
  const logoutBtn = document.getElementById('logoutBtn');
  const adminToggleBtn = document.getElementById('adminToggleBtn');
  const tabsNav = document.getElementById('tabsNav');
  const tabButtons = tabsNav.querySelectorAll('button.tab-btn');
  const sections = document.querySelectorAll('main section');

  let currentUser = null;
  let isAdmin = false;
  let adminPanelVisible = false;

  // Helper: show section by id
  function showSection(id) {
    sections.forEach(sec => {
      sec.style.display = (sec.id === id) ? 'block' : 'none';
    });
    tabButtons.forEach(btn => {
      btn.classList.toggle('active', btn.getAttribute('data-target') === id);
    });
  }

  // Handle tab clicks
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.getAttribute('data-target');
      showSection(target);
    });
  });

  // Logout
  logoutBtn.addEventListener('click', async () => {
    await signOut(auth);
    window.location.href = 'login.html';
  });

  // Load and display announcements
  const announcementsCol = collection(db, "announcements");
  const announcementList = document.getElementById('announcementList');
  function loadAnnouncements() {
    onSnapshot(announcementsCol, (snapshot) => {
      announcementList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = data.text || "(No content)";
        announcementList.appendChild(li);
      });
    });
  }

  // Load and display events
  const eventsCol = collection(db, "events");
  const eventList = document.getElementById('eventList');
  function loadEvents() {
    onSnapshot(eventsCol, (snapshot) => {
      eventList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = `${data.title || "(No title)"} - ${data.date || "(No date)"}`;
        eventList.appendChild(li);
      });
    });
  }

  // Load and display birthday wall
  const birthdayCol = collection(db, "birthdayWall");
  const birthdayList = document.getElementById('birthdayList');
  function loadBirthdayWall() {
    onSnapshot(birthdayCol, (snapshot) => {
      birthdayList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = `${data.name || "(No name)"} — ${data.birthday || "(No birthday)"}`;
        birthdayList.appendChild(li);
      });
    });
  }

  // Load and display lost and found
  const lostCol = collection(db, "lostAndFound");
  const lostList = document.getElementById('lostList');
  function loadLostAndFound() {
    onSnapshot(lostCol, (snapshot) => {
      lostList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = `${data.itemName || "(No item)"} — ${data.description || "(No description)"}`;
        lostList.appendChild(li);
      });
    });
  }

  // Load and display study resources
  const resourceCol = collection(db, "studyResources");
  const resourceList = document.getElementById('resourceList');
  function loadResources() {
    onSnapshot(resourceCol, (snapshot) => {
      resourceList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = data.link || "#";
        a.target = "_blank";
        a.textContent = data.title || "(No title)";
        li.appendChild(a);
        resourceList.appendChild(li);
      });
    });
  }

  // Load and display feedback
  const feedbackCol = collection(db, "feedback");
  const feedbackList = document.getElementById('feedbackList');
  function loadFeedback() {
    onSnapshot(feedbackCol, (snapshot) => {
      feedbackList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = data.text || "(No feedback)";
        feedbackList.appendChild(li);
      });
    });
  }

  // Admin-only: Manage executives
  const execSection = document.getElementById('executives');
  const execList = document.getElementById('execList');
  const execNameInput = document.getElementById('execName');
  const execRoleInput = document.getElementById('execRole');
  const execMessage = document.getElementById('execMessage');
  const executivesCol = collection(db, "executives");

  async function loadExecutives() {
    onSnapshot(executivesCol, (snapshot) => {
      execList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = `${data.name} — ${data.role}`;
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = async () => {
          await deleteDoc(doc(db, "executives", doc.id));
        };
        li.appendChild(delBtn);
        execList.appendChild(li);
      });
    });
  }
  document.getElementById('addExecBtn').addEventListener('click', async () => {
    if(!execNameInput.value || !execRoleInput.value) {
      execMessage.textContent = "Please fill all fields.";
      return;
    }
    await addDoc(executivesCol, {
      name: execNameInput.value.trim(),
      role: execRoleInput.value.trim()
    });
    execNameInput.value = '';
    execRoleInput.value = '';
    execMessage.textContent = "Executive added.";
  });

  // Admin-only: Manage users
  const usersCol = collection(db, "users");
  const userList = document.getElementById('userList');
  const userMessage = document.getElementById('userMessage');

  async function loadUsers() {
    onSnapshot(usersCol, (snapshot) => {
      userList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = `${data.fullName || 'No name'} — ${data.email || 'No email'}`;
        const blockBtn = document.createElement('button');
        blockBtn.textContent = data.blocked ? 'Unblock' : 'Block';
        blockBtn.onclick = async () => {
          await updateDoc(doc(db, "users", doc.id), { blocked: !data.blocked });
        };
        li.appendChild(blockBtn);
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = async () => {
          await deleteDoc(doc(db, "users", doc.id));
        };
        li.appendChild(delBtn);
        userList.appendChild(li);
      });
    });
  }

  // Toggle admin panel visibility
  adminToggleBtn.addEventListener('click', () => {
    adminPanelVisible = !adminPanelVisible;
    document.querySelectorAll('.admin-only').forEach(btn => {
      btn.style.display = adminPanelVisible ? 'inline-block' : 'none';
    });
    document.querySelectorAll('section.admin-only').forEach(sec => {
      sec.style.display = adminPanelVisible && sec.id === document.querySelector('.tab-btn.active').dataset.target ? 'block' : 'none';
    });
    adminToggleBtn.textContent = adminPanelVisible ? "Hide Admin Panel" : "Show Admin Panel";

    // If admin panel hidden, switch to default tab
    if(!adminPanelVisible) {
      showSection('announcements');
    }
  });

  // On auth state change
  onAuthStateChanged(auth, async (user) => {
    if(user) {
      currentUser = user;
      // Load user data from Firestore
      const userDoc = doc(db, "users", user.uid);
      const userSnap = await getDocs(collection(db, "users"));
      const currentUserData = userSnap.docs.find(d => d.id === user.uid)?.data();
      isAdmin = currentUserData?.admin || false;

      if(isAdmin){
        adminToggleBtn.style.display = 'inline-block';
        // Preload admin data
        loadExecutives();
        loadUsers();
      } else {
        adminToggleBtn.style.display = 'none';
      }

      // Load common data for all users
      loadAnnouncements();
      loadEvents();
      loadBirthdayWall();
      loadLostAndFound();
      loadResources();
      loadFeedback();

      // Show default section
      showSection('announcements');

    } else {
      // Not logged in
